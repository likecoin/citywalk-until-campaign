<template>
  <main class="relative overflow-hidden" style="opacity: 0">

    <UButton
      id="skip-button"
      class="absolute z-[2] top-4 right-4"
      label="略過"
      color="amber"
      :ui="{ rounded: 'rounded-full' }"
      @click="onClickSkip"
    />

    <div class="absolute inset-x-0 top-1/2 translate-y-[-50%]">    
      <div class="relative">
        <div class="absolute inset-x-0 top-0 min-h-[5vh] bg-gradient-to-b from-[#fef2e9]" />
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1125 2436">
          <defs>
            <clipPath id="dashed-lines-clippath">
              <rect width="1125" height="2436" />
            </clipPath>
          </defs>
          <g id="splash">
            <g id="street-blueprint">
              <path d="M-995.73,1725.55L494.05,682.4c124.91-87.46,260.45-159.43,402.87-213.92L2384.44-100.6" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <path d="M978.13,1202.02h0s-336.04,235.3-336.04,235.3c-32.18,22.53-56.43,53.9-70.14,90.71l-82.98,222.83c-33.27,89.33-92.12,165.44-170.2,220.11l-766.63,536.8" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <path d="M766.44,1164.69c68.77-48.15,163.54-31.44,211.69,37.33l358.49,511.97" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <path d="M-535.06,2383.27L231.58,1846.47c52.73-36.92,92.48-88.32,114.94-148.65l82.98-222.83c24.51-65.81,67.87-121.89,125.4-162.17l211.53-148.12c68.77-48.15,163.54-31.44,211.69,37.33" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <line x1="-1213.69" y1="1414.28" x2="92.08" y2="499.97" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <polyline points="1212.1 1801.18 766.44 1164.69 766.44 1164.69" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <path d="M2365.39,778.04l-138.15,68.04c-5.71,2.81-573.28,282.3-777.56,379.78-63.71,30.4-129.53,51.91-195.63,63.92-70.11,12.74-139.03,14.51-204.87,5.27-71.98-10.11-138.87-33.16-198.83-68.53-64.05-37.78-118.87-88.85-162.93-151.77-39.32-56.15-116.98-69.84-173.13-30.53l-1333.18,933.51" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <line x1="143.7" y1="573.69" x2="-1162.07" y2="1488" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <line x1="1418.69" y1="478.35" x2="227.47" y2="-543.82" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <path d="M-995.55,1725.43L337.64,791.92c47.75-33.44,100.71-56.54,157.4-68.66,54.68-11.7,110.4-12.69,165.63-2.95,55.23,9.74,107.25,29.73,154.63,59.42,49.13,30.79,90.99,70.61,124.43,118.36,18.65,26.63,41.23,47.88,67.12,63.15,24.87,14.67,53.52,24.36,85.16,28.8,68.12,9.56,148.03-5.4,225.02-42.15,202.57-96.67,768.44-375.32,774.14-378.12l138.15-68.04" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <line x1="-320.9" y1="2689.11" x2="2345.47" y2="822.09" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <line x1="319.94" y1="-651.59" x2="1400.66" y2="275.77" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <line x1="2432.65" y1="946.61" x2="-233.72" y2="2813.62" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <line x1="-321.36" y1="-90.48" x2="423.03" y2="972.61" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <path d="M2454.83,83.39L967.3,652.48c-127.35,48.72-248.56,113.08-360.26,191.29L-882.73,1886.93" fill="none" stroke="#000" stroke-miterlimit="10"/>
              <line x1="298.51" y1="1059.79" x2="-445.87" y2="-3.29" fill="none" stroke="#000" stroke-miterlimit="10"/>
            </g>
            <g id="building-fill">
              <path d="M346.52,1697.82l82.98-222.83c24.51-65.81,67.87-121.89,125.4-162.17l211.53-148.12c-29.21-26.5-55.63-56.55-79.01-89.95-39.32-56.15-116.98-69.84-173.13-30.53l-1278.03,894.89,283.92,405.48,711.39-498.12c52.73-36.92,92.48-88.32,114.94-148.65Z" fill="#ffd9ae" opacity=".5" stroke-width="0"/>
              <rect x="-1147.85" y="1028.84" width="1374.5" height="290" transform="translate(-756.59 -51.9) rotate(-35)" fill="#ffd9ae" opacity=".5" stroke-width="0"/>
              <path d="M853.62,1289.21l-211.53,148.12c-32.18,22.53-56.43,53.9-70.14,90.71l-82.98,222.83c-33.27,89.33-92.12,165.44-170.2,220.11l-711.39,498.12,126.97,181.33,1390.62-973.72-271.33-387.5Z" fill="#6c7946" opacity=".5" stroke-width="0"/>
              <path d="M2191.79,929.7l-34.47-49.22c-159.05,78.21-546.46,268.46-707.65,345.39-63.71,30.4-129.53,51.91-195.63,63.92-70.11,12.74-139.03,14.51-204.87,5.27-2.2-.31-4.4-.63-6.59-.96l206.87,295.44,35.12-24.59-.21-.3,124.51-87.18.21.3,782.7-548.05Z" fill="#ffd9ae" opacity=".5" stroke-width="0"/>
              <polygon points="1400.66 275.77 1663.49 175.21 930.86 -871.09 453.59 -536.9 1400.66 275.77" fill="#6c7946" opacity=".5" stroke-width="0"/>
              <path d="M758.14,749.6c19.69,8.57,38.78,18.61,57.16,30.12,49.13,30.79,90.99,70.61,124.43,118.36,18.65,26.63,41.23,47.88,67.12,63.15,24.87,14.67,53.52,24.36,85.16,28.8,68.12,9.56,148.03-5.4,225.02-42.15,146.86-70.09,484.66-235.81,661.53-322.74l-198.57-283.59-812.68,310.91c-71.88,27.5-141.8,59.98-209.16,97.12Z" fill="#ae7546" opacity=".5" stroke-width="0"/>
              <rect x="-163.3" y="2173.45" width="1892.5" height="649.64" transform="translate(-1291.35 900.89) rotate(-35)" fill="#ffd9ae" opacity=".5" stroke-width="0"/>
              <path d="M896.91,468.48l352.93-135.02L333.52-452.83-276.16-25.93l133.57,190.76,87.18,124.51,147.48,210.63,51.62,73.72,166.34,237.55,27.6-19.32,156.41-109.52c124.91-87.46,260.45-159.43,402.87-213.92Z" fill="#ffd9ae" opacity=".5" stroke-width="0"/>
            </g>
            <g id="dashed-lines" clip-path="url(#dashed-lines-clippath)">
              <path d="M-1046.48,1860.58l44.67-31.28L384.38,858.68c38.77-27.14,81.73-45.9,127.7-55.73,44.36-9.49,89.59-10.29,134.43-2.39,44.84,7.91,87.06,24.13,125.51,48.22,39.83,24.96,73.8,57.28,100.94,96.05,25.37,36.24,56.49,65.37,92.47,86.6,34.15,20.15,72.92,33.37,115.23,39.32,83.78,11.76,180.18-5.75,271.45-49.3,203.03-96.89,769.35-375.76,775.04-378.57l54.29-26.74" fill="none" stroke="#000" stroke-dasharray="0 0 12 12" stroke-miterlimit="10"/>
              <path d="M2256.27,740.94l-65.04,32.03c-5.71,2.81-572.82,282.07-776.65,379.35-57.19,27.29-116.1,46.57-175.09,57.28-61.54,11.18-121.75,12.78-178.97,4.75-127.58-17.91-233.51-82.35-306.32-186.34-65.09-92.96-193.68-115.63-286.64-50.54l-1445.57,1012.2" fill="none" stroke="#000" stroke-dasharray="0 0 12 12" stroke-miterlimit="10"/>
            </g>
            <g id="title">
              <path d="M181.4,1151.12l-11.95,8.86-55.54-74.91,19.25-14.27c3.65-2.71,6.91-2.13,9.77,1.73l51.25,69.12-12.78,9.48ZM178.52,1143.31l3.08-2.28-46.03-62.08-9.08,6.73,46.03,62.08,6-4.45ZM154.64,1068.04l-12.8-17.27,8.03-5.96,12.8,17.27,9.49-7.04c2.71-2.01,4.96-2.79,6.75-2.34,1.82.43,3.68,1.91,5.56,4.45l47.46,64.01c3.53,4.76,3.16,8.73-1.12,11.9l-13.51,10.02-6.74-5.27,13.72-10.17-48.31-65.16-8.4,6.23,14.85,20.03c13.67,18.43,20.49,35.6,20.48,51.51.02,4.89-.61,11.07-1.87,18.52l-5.34-7.2c.07-7.33-.4-13.47-1.39-18.45-2.06-10.49-8.68-23.26-19.84-38.32l-14.93-20.14-7.3,5.42-4.91-6.62,7.3-5.42ZM179.89,1037.43l18.89-14c2.4-1.78,4.57-2.52,6.51-2.24,1.94.29,3.8,1.63,5.58,4.03l58.29,78.62-25.82,19.15-63.43-85.56ZM202.59,1030.87l-9.76,7.23,53.61,72.3,9.76-7.23-53.61-72.3Z" fill="#42210b" stroke-width="0"/>
              <path d="M295.3,948.15l6.94-5.14c2.96-2.19,5.58-3.12,7.89-2.77,2.24.33,4.4,1.91,6.49,4.72l53.38,71.99-15.29,11.33-12.52,9.28-59.41-80.13,12.52-9.28ZM352.46,1019.68l3.86-2.86-49.58-66.88-4.07,3.02-6.21,4.6,49.58,66.88,6.42-4.76ZM335.28,930.32l-10.75-14.5,9.23-6.85,71.98,97.08-9.23,6.85-16.79-22.64-17.58,13.03-4.91-6.62,17.58-13.03-15.32-20.66-14.19,10.52-4.91-6.63,14.19-10.52-14.39-19.41-15.39,11.41-4.91-6.63,15.39-11.41ZM408.67,968.79l16.79,22.64-9.23,6.85-71.98-97.08,9.23-6.85,10.75,14.5,17.48-12.96,4.91,6.62-17.48,12.96,14.39,19.41,15.13-11.22,4.91,6.62-15.13,11.22,15.32,20.66,19.61-14.54,4.91,6.63-19.61,14.54Z" fill="#42210b" stroke-width="0"/>
              <g>
                <path d="M533.4,866.77l-5.23.95-1.84-3.69c-.39-.78-1.25-1.22-2.12-1.06l-17.87,3.23-17.87,3.23c-.86.16-1.52.86-1.61,1.73l-.43,4.1-5.23.95c-.47.08-.78.53-.69,1l.96,5.3,26.94-4.87,26.94-4.87-.96-5.3c-.08-.47-.53-.78-1-.69Z" stroke-width="0"/>
                <path d="M535.86,914.72l-.1-1.56-.14-2.22-.44-6.81-.44-6.81-.14-2.23-.4-6.2-.89-13.73-24.52,4.44-24.52,4.44,3.98,13.17,1.8,5.95.64,2.13,1.97,6.53,1.97,6.53.64,2.13.45,1.5,4.3,14.23c.58,1.93,2.53,3.12,4.51,2.76l5.43-.98-5.62-18.61-.15-.5,22.67-4.1.03.52.67,10.36-7.84,1.42,2.62,8.67,11.24-2.03c1.99-.36,3.39-2.15,3.26-4.17l-.96-14.83ZM510.55,889.44l13.49-2.44.16,2.54.4,6.2v.13s-24.97,4.52-24.97,4.52l-.04-.13-1.8-5.95-.74-2.44,13.49-2.44Z" fill="#42210b" stroke-width="0"/>
                <path d="M486,855.15l-2.91-16.24-11.57,2.08-1.46-8.12,11.57-2.08-2.12-11.83,11.06-1.98,2.12,11.83,14.25-2.56-2.12-11.83,11.06-1.98,2.12,11.83,11.63-2.09,1.45,8.12-11.63,2.09,2.91,16.24,13.04-2.34,1.45,8.12-63.28,11.35-1.46-8.12,13.87-2.49ZM494.15,836.93l2.91,16.24,14.25-2.56-2.91-16.24-14.25,2.56ZM552.63,826.37l35.48-6.36,1.46,8.12-7.48,1.34c.12.9.46,3.92,1.03,9.05,1.71,15.92,1.39,29.35-.96,40.29-.8,3.88-2.13,8.26-3.98,13.12,4.29,4.29,8.35,7.83,12.2,10.61,3.68,2.64,8.73,5.65,15.14,9.03l1.48,8.25c-10.26-4.01-17.99-7.71-23.17-11.09-3.04-2-6.36-4.56-9.95-7.65-1.28,2.17-2.3,3.84-3.06,5.04-4.9,7.52-12.48,15.65-22.74,24.4l-1.41-7.86c5.64-5.59,10.06-10.84,13.27-15.77,2.29-3.44,4.58-7.7,6.88-12.78-5.59-6.17-10.14-12.24-13.63-18.21-2.53-4.3-5.12-9.68-7.78-16.16-1.73,4.09-4.2,8.69-7.42,13.8l-1.79-9.97c3.19-8.97,4.9-17.42,5.16-25.34.26-7.88-.19-17.87-1.35-29.98l11.89-2.13c.6,8.25.84,15,.73,20.26ZM552.1,834.85c-.63,5.83-1.68,10.99-3.16,15.48l4.41-.79c5.5,14.5,11.24,25.67,17.23,33.53,1.02-3.88,1.73-7.41,2.12-10.61,1.17-9.89.63-23.56-1.62-41.01l-18.99,3.41Z" fill="#42210b" stroke-width="0"/>
              </g>
              <path d="M742.61,894.05l43.49,25.21-4.14,7.14-47.03-27.26-20.23,34.89-10.73-6.22,20.23-34.89-45.12-26.15,4.14-7.14,18.04,10.46,17.23-29.72,10.45,6.06-17.23,29.72,20.17,11.69,21.95-37.87,10.73,6.22-7.95,13.71,35.06,20.32-4.14,7.14-35.06-20.32-9.87,17.02ZM757.93,923.04l11.63,6.74c-12.97,9.85-26.4,15.45-40.29,16.8-18.33,1.84-39.35-1.74-63.06-10.74-3.94-1.49-10.98-4.32-21.12-8.49l3.29-5.67c20.44,7.9,37.78,12.92,52,15.06,10.42,1.54,20.61,1.26,30.58-.82,8.53-1.76,17.52-6.06,26.98-12.88ZM667.56,898.15c-.27,1.92.44,2.9,2.35,3.26,2.51.48,4.95.23,7.36-.6,3.13-1.08,5.93-2.82,8.82-4.39,3.78-2.06,7.7-3.33,12.09-2.69,1.11.16,2.24.06,3.37-.06.68-.08.8-.38.77-.97-.07-1.29-.65-2.33-1.56-3.19-1.82-1.74-4-2.9-6.39-3.57-5.8-1.62-11.46-.9-16.96,1.33-3.45,1.39-6.4,3.47-8.33,6.61-.8,1.41-1.31,2.8-1.51,4.29ZM675.82,910.94c7.91,2.25,15.26.94,21.99-3.7,2.36-1.63,4.24-3.8,5.32-6.52.7-1.77.15-3.03-1.67-3.53-3.57-.98-7.16-.83-10.66.34-2.86.95-5.31,2.73-7.88,4.25-3.62,2.15-7.42,3.38-11.69,2.63-.63-.11-1.3-.09-1.94-.02-.82.1-.97.49-.54,1.2,1.06,1.73,2.48,3.08,4.26,4.06.89.54,1.83,1,2.83,1.28Z" fill="#42210b" stroke-width="0"/>
              <path d="M853.26,1071.55l3.5-4.01,22.44,6.48-39.24-34.25,5.04-5.77,54.56,47.61-5.04,5.77-30.52-8.88-1.2,1.37,39.93,34.84-5.25,6.02-39.93-34.84-8.67,9.93c-2.22,2.55-4.41,3.94-6.57,4.18-2.19.21-4.56-.79-7.11-3.02l-17.71-15.46,3.23-7.35,17.17,14.99,10.12-11.6-40.66-35.48,5.25-6.02,40.66,35.48ZM841.62,1023.55l-9.86,11.3-8.46-7.39,14.9-17.08,6.31,5.51,31.64-36.26,11.11,9.69c2.02,1.76,4,2.17,5.93,1.21l7.98,6.96-.09.1c-.83.95-2.3,1.84-4.42,2.69-2.42.93-4.8.92-7.14-.02-1.67-.65-3.86-2.16-6.57-4.52l-3.62-3.16-5.47,6.26,13.36,11.66-5.04,5.77-13.36-11.66-5.47,6.26,13.36,11.66-5.04,5.77-13.36-11.66-5.59,6.41,57.44,50.13,5.68-6.51-13.31-11.61,5.04-5.77,13.31,11.62,5.21-5.97-13.31-11.61,5.04-5.77,13.31,11.62,5.51-6.31-13.7-11.96,5.04-5.77,15.41,13.45c4.37,3.81,4.68,7.88.92,12.18l-25.88,29.65c1.99,1.8,3.1,3.39,3.32,4.79.29,2.1-.52,4.25-2.46,6.47l-9.69,11.11-8.47-7.39,9.86-11.3-69.38-60.55ZM895.22,1034.64c2.58-.39,5.61-1.16,9.09-2.32l8.27,7.22c-4.87,1.56-9.67,2.48-14.4,2.77.84,2.46,1.63,4.81,2.37,7.06l-7.22,8.27c-1.95-7.91-3.27-13.08-3.95-15.52-5.82-.71-12.53-2.57-20.12-5.58l3.89-4.45c5.79,1.6,10.54,2.54,14.27,2.8-1.32-4.6-2.7-9.08-4.13-13.44l3.71-4.26c3.39,6.52,6.13,12.33,8.23,17.44ZM912.47,1014.96c2.92-.32,5.88-.91,8.86-1.75l8.12,7.09c-4.18,1.3-8.84,2.03-13.98,2.19.6,1.62,1.34,3.96,2.23,7.03l-7.13,8.17c-1.71-7.12-3.05-12.37-4.02-15.74-5.58-.79-12.11-2.75-19.59-5.89l3.67-4.21c4.92,1.48,9.51,2.5,13.79,3.07-.88-2.95-2.22-7.07-4.02-12.38l3.93-4.5c3.86,7.62,6.58,13.27,8.15,16.94Z" fill="#42210b" stroke-width="0"/>
            </g>
          </g>
        </svg>
        <div class="absolute inset-x-0 bottom-0 min-h-[5vh] bg-gradient-to-t from-[#fef2e9]" />
      </div>
    </div>
      
    <footer class="absolute inset-x-0 bottom-0 bg-[#603813]">
      <div class="relative flex flex-col items-center justify-end gap-4 p-8 bg-cover bg-top">
        <svg class="absolute inset-x-0 w-full bottom-full pointer-events-none translate-y-[35%]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1125 260">
          <defs>
            <clipPath id="cup-clippath">
              <path d="M-455.6,0v583.85C-455.6,344.06.22,149.67,562.5,149.67s1018.1,194.39,1018.1,434.19V0H-455.6Z" fill="none" stroke-width="0"/>
            </clipPath>
            <clipPath id="coffee-clippath">
              <path d="M-455.6,0v609.87C-455.6,370.07.22,175.68,562.5,175.68s1018.1,194.39,1018.1,434.19V0H-455.6Z" fill="none" stroke-width="0"/>
            </clipPath>
          </defs>
          <g clip-path="url(#cup-clippath)">
            <ellipse cx="562.5" cy="434.19" rx="1018.1" ry="434.19" fill="#fff" stroke-width="0"/>
            <ellipse cx="562.5" cy="472.02" rx="1018.1" ry="434.19" fill="#f2f2f2" stroke="#fff" stroke-miterlimit="10" stroke-width="4"/>
          </g>
          <g clip-path="url(#coffee-clippath)">
            <ellipse cx="562.5" cy="558.99" rx="1018.1" ry="434.19" fill="#42210b" stroke-width="0"/>
          </g>
        </svg>
        <img class="absolute inset-x-0 w-full top-0 pointer-events-none" src="~/assets/images/stirring.svg" />
        <img class="absolute inset-x-0 w-full bottom-full pointer-events-none translate-y-[10%] scale-x-125 blur-lg" src="~/assets/images/steam.svg" />
        <div
          id="slogan"
          class="relative text-3xl text-center font-cursive tracking-widest text-white"
        >喝一杯咖啡<br>給自己散步的空檔</div>
        <UButton
          class="relative"
          :to="{ name: 'preface' }"
          size="xl"
          color="amber"
          @click="onClickStart"
        >開始散步</UButton>
      </div>
    </footer>

  </main>
</template>

<script setup lang="ts">
const { $gsap } = useNuxtApp()

onMounted(() => {
  animateSplash({ timeScale: 2.5 })
})

const animationTimeline = ref<GSAPTimeline>()

function animateSplash({ timeScale = 1 } = {}) {
  const tl = $gsap.timeline({
    onComplete: () => {
      useTrackEvent('AnimationComplete')
    },
  })

  tl.timeScale(timeScale)

  tl.set('main', { opacity: 1 })
  tl.set('#skip-button', { opacity: 1 })
  tl.set('#street-blueprint', { opacity: 1 })

  tl.from('#street-blueprint > *', {
    duration: 1,
    ease: 'power2.out',
    opacity: 0,
    stagger: 0.25,
  }, '+=1')

  tl.from('#building-fill > *', {
    duration: 1.5,
    ease: 'power2.out',
    opacity: 0,
    stagger: 0.25,
  }, '-=2')

  tl.to('#street-blueprint', {
    duration: 2,
    ease: 'power2.in',
    opacity: 0,
  }, '-=2')

  tl.addLabel('title', '-=0.25')

  tl.to('#skip-button', {
    duration: 0.5,
    opacity: 0,
  })

  tl.from('#dashed-lines', {
    duration: 5,
    opacity: 0,
    ease: 'power2.out',
  }, 'title')

  tl.from('#dashed-lines-clippath', {
    duration: 5,
    x: '-100%',
    ease: 'power2.out',
  }, 'title')

  tl.from('#title > *', {
    duration: 1,
    opacity: 0,
    stagger: 0.3,
    ease: 'power2.out',
  }, 'title+=1')

  tl.addLabel('footer', '-=3')

  tl.from('footer', {
    duration: 2,
    opacity: 0,
    y: 30,
    ease: 'power2.out',
  }, 'title')

  tl.from('footer #slogan', {
    duration: 2,
    opacity: 0,
    y: 30,
    ease: 'power2.out',
  }, 'footer')

  tl.from('footer a', {
    duration: 2,
    opacity: 0,
    y: 30,
    ease: 'power2.out',
  }, 'footer+=1.5')

  tl.from('#splash', {
    duration: 10,
    rotate: -45,
    scale: 0.75,
    transformOrigin: '50% 50%',
    ease: 'power2.out',
  }, '0')

  animationTimeline.value = tl
}

function onClickStart() {
  useTrackEvent('ClickStart')
}

function onClickSkip() {
  animationTimeline.value?.play('title')
  useTrackEvent('ClickSkipAnimation')
}
</script>
